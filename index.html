<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>QB-Nexa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="ico/favicon.ico">

  <script src="js/version.js" defer></script>
  <script src="js/version-check.js" defer></script>
  <script defer src="js/login.js"></script>

  <!-- ØªØ­Ù…ÙŠÙ„ CSS (Ø£Ø¶ÙÙ†Ø§ nfs.css Ù‡Ù†Ø§ Ù…Ø¹ Ù†ÙØ³ Ø¢Ù„ÙŠØ© bust) -->
  <script>
  document.addEventListener('DOMContentLoaded', function boot(){
    var V = (window.APP_VERSION || 'v3.3 Nova');
    function bust(u){ return u + (u.indexOf('?')>-1?'&':'?') + 'v=' + encodeURIComponent(V); }

    var css = ['css/modern-login-style.css', 'css/nfs.css']; // â† ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    css.forEach(function(href){
      var l = document.createElement('link');
      l.rel = 'stylesheet';
      l.href = bust(href);
      document.head.appendChild(l);
    });
  });
  </script>
</head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<script>
(function enforceLoginPageRefresh(){
  const RELOAD_AFTER_MINUTES = 5;
  const RELOAD_MS = RELOAD_AFTER_MINUTES * 60 * 1000;

  function hardReload() {
    const url = new URL(location.href);
    url.searchParams.set("_r", Date.now().toString());
    location.replace(url.toString());
  }

  window.addEventListener("storage", (e) => {
    if (e.key === "qb_login_signal" || e.key === "qb_session") {
      hardReload();
    }
  });

  setTimeout(hardReload, RELOAD_MS);

  let lastVisibleAt = Date.now();
  document.addEventListener("visibilitychange", () => {
    if (!document.hidden) {
      const now = Date.now();
      if (now - lastVisibleAt > RELOAD_MS) hardReload();
      lastVisibleAt = now;
    }
  });
})();
</script>

<body class="modern-login-page">
  <header class="modern-header">
    <div class="header-content">
      <div class="brand-section">
        <h1 class="brand-title">QB-Nexa</h1>
      </div>
      <div class="version-badge"></div>
      <div class="header-gradient"></div>
    </div>
  </header>

  <main class="login-container">
    <div class="login-wrapper">
      <section class="login-card">
        <div class="login-header">
          <div class="login-icon">
            <span class="icon-symbol">ğŸ”</span>
          </div>
          <h2 class="login-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
          <p class="login-subtitle">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        </div>

        <form id="loginForm" class="login-form" autocomplete="on" novalidate>
          <div class="input-group">
            <label for="userId" class="input-label">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ</label>
            <div class="input-wrapper">
              <input
                id="userId"
                class="login-input"
                type="text"
                inputmode="numeric"
                pattern="[0-9]*"
                placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ"
                required
                aria-label="Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ"
              />
              <div class="input-decoration"></div>
            </div>
          </div>

          <button type="submit" class="login-btn" id="loginBtn">
            <span class="btn-text">Ø¯Ø®ÙˆÙ„</span>
           
          </button>

          <!-- Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ­Ø¯Ù‘Ø«Ù‡ login.js -->
          <div class="login-status" id="msg" role="status" aria-live="polite"></div>
        </form>

        <div class="login-footer">
          <div class="welcome-text">
            <span class="welcome-label">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ</span>
            <span class="brand-name">QB-Nexa</span>
          </div>
          <div class="app-description">Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</div>
        </div>
      </section>

      <section class="features-section">
        <div class="feature-item">
          <div class="feature-icon">ğŸ“‚</div>
          <div class="feature-text">
            <div class="feature-title">Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø­ÙÙˆØ¸Ø©</div>
            <div class="feature-desc">Ø§Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ø³ØªØ¹Ø¯Ù‡Ø§ ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ø¬Ø©</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">ğŸŒ</div>
          <div class="feature-text">
            <div class="feature-title">ÙÙŠ Ø£ÙŠ ÙˆÙ‚ØªØŒ Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù†</div>
            <div class="feature-desc">Ù†ØªØ§Ø¦Ø¬ ÙÙˆØ±ÙŠØ© ÙˆØ¯Ù‚ÙŠÙ‚Ø©</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">ğŸŒŸ</div>
          <div class="feature-text">
            <div class="feature-title">Ø®Ø·ÙˆØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ© ØªØ¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§</div>
            <div class="feature-desc">Ù†Ø¸Ø§Ù…Ùƒ Ø¬Ø§Ù‡Ø² Ø¯Ø§Ø¦Ù…Ù‹Ø§</div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="modern-footer">
    <div class="footer-content">
      <div class="developer-info">
        <div class="dev-main">
          <span class="dev-name">ØªØ·ÙˆÙŠØ± : Ø¨Ù„Ø§Ù„ Ø§Ù„Ø®ÙˆØ§Ø¬Ø©</span>
        </div>
        <div class="dev-details">
          <span class="dev-date"></span>
          <span class="dev-separator">â€¢</span>
          <span class="dev-base">Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„Ø£ØµÙ„ÙŠØ©</span>
        </div>
      </div>
    </div>
  </footer>

  <div class="bg-animation">
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
    <div class="floating-shape shape-4"></div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© NFS Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: Ø¨Ù„Ø§ Ø£Ø²Ø±Ø§Ø± Ø¥ØºÙ„Ø§Ù‚ØŒ ØªØ¨Ù‚Ù‰ Ø­ØªÙ‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø£Ùˆ ÙØ´Ù„/Ø­Ø¸Ø± -->
<!-- Ù†Ø§ÙØ°Ø© NFS Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©: Ø¨Ù„Ø§ Ø£Ø²Ø±Ø§Ø± Ø¥ØºÙ„Ø§Ù‚ -->
<div class="features-modal-overlay-nfs" id="featuresModal" aria-hidden="true" role="dialog" aria-modal="true" style="display:none">
  <div class="features-modal-nfs" aria-labelledby="nfsTitle" aria-describedby="nfsSubtitle">
    <div class="features-modal-header-nfs">
      <div class="features-header-icon-nfs">âœ¨</div>
      <h2 id="nfsTitle" class="features-modal-title-nfs">Ø¬Ø¯ÙŠØ¯Ù†Ø§</h2>
      <p id="nfsSubtitle" class="features-modal-subtitle-nfs">Ù†ÙØ­Ø¶Ù‘Ø± Ù„Ùƒ ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØªÙ…Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
      <div id="nfsStatus" class="login-status checking">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦</div>
    </div>

    <div class="features-modal-content-nfs">
      <div class="features-slideshow-nfs" id="nfsSlideshow" aria-live="polite">
        <!-- Ø´Ø±ÙŠØ­Ø© 1 -->
        <div class="feature-slide-nfs active">
          <div class="feature-item-nfs">
            <div class="feature-header-nfs">
              <div class="feature-icon-nfs">ğŸ’¾</div>
              <h3 class="feature-title-nfs">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
            </div>
            <p class="feature-text-nfs">Ø®Ø²Ù‘Ù† Ø¹Ù…Ù„ÙŠØ§ØªÙƒ Ø¨Ø³Ø±Ø¹Ø©ØŒ ÙˆØ§Ø±Ø¬Ø¹ Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙÙŠ Ø«ÙˆØ§Ù†Ù.</p>
          </div>
        </div>
        <!-- Ø´Ø±ÙŠØ­Ø© 2 -->
        <div class="feature-slide-nfs">
          <div class="feature-item-nfs">
            <div class="feature-header-nfs">
              <div class="feature-icon-nfs">ğŸ§°</div>
              <h3 class="feature-title-nfs">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø¯ÙˆØ§Øª</h3>
            </div>
            <p class="feature-text-nfs">ÙƒÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯: Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ† + Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ â€” ÙˆØµÙˆÙ„ ÙÙˆØ±ÙŠ Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø¸Ø§Ù….</p>
          </div>
        </div>
        <!-- Ø´Ø±ÙŠØ­Ø© 3 -->
        <div class="feature-slide-nfs">
          <div class="feature-item-nfs">
            <div class="feature-header-nfs">
              <div class="feature-icon-nfs">ğŸ’°</div>
              <h3 class="feature-title-nfs">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹</h3>
            </div>
            <p class="feature-text-nfs">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø¨Ø³Ø±Ø¹Ø©ØŒ Ù…Ø¹ Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ù‚Ø³Ø· Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­.</p>
          </div>
        </div>
      </div>

      <div class="feature-dots-nfs" id="nfsDots" aria-hidden="true"></div>
    </div>
  </div>
</div>


  <script>

function hardReload(delayMs){
  setTimeout(function(){
    var url = new URL(location.href);
    url.searchParams.set('_r', Date.now().toString());
    location.replace(url.toString());
  }, typeof delayMs === 'number' ? delayMs : 250);
}


(function(){
  'use strict';

  // Core elements
  var overlay   = document.getElementById('featuresModal');   // must have class .features-modal-overlay-nfs
  var statusEl  = document.getElementById('nfsStatus');
  var slideshow = document.getElementById('nfsSlideshow');
  var dotsWrap  = document.getElementById('nfsDots');
  var msgEl     = document.getElementById('msg');             // updated by login.js
  var formEl    = document.getElementById('loginForm');
  var loginBtn  = document.getElementById('loginBtn');
  var userInput = document.getElementById('userId');

  // -------- Slider setup (uses -nfs classes) --------
  var slides   = slideshow ? Array.prototype.slice.call(slideshow.querySelectorAll('.feature-slide-nfs')) : [];
  var dots     = [];
  var current  = 0;
  var TIMER    = null;
  var INTERVAL = 3000;

  function buildDots(){
    if (!dotsWrap || !slides.length) return;
    dotsWrap.innerHTML = '';
    dots = slides.map(function(_, i){
      var d = document.createElement('span');
      d.className = 'feature-dot-nfs' + (i === 0 ? ' active' : '');
      dotsWrap.appendChild(d);
      return d;
    });
  }

  function go(i){
    if (!slides.length) return;
    current = (i + slides.length) % slides.length;
    for (var idx = 0; idx < slides.length; idx++){
      slides[idx].classList.toggle('active', idx === current);
      if (dots[idx]) dots[idx].classList.toggle('active', idx === current);
    }
  }

  function startSlider(){
    stopSlider();
    if (slides.length) TIMER = setInterval(function(){ go(current + 1); }, INTERVAL);
  }
  function stopSlider(){
    if (TIMER){ clearInterval(TIMER); TIMER = null; }
  }

  if (slides.length){ buildDots(); go(0); }

  // -------- NFS API --------
  var NFS = {
    open: function(text, type){
      this.setStatus(text || 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦', type || 'checking');
      // Force visible even if CSS not yet applied
      if (overlay){
        overlay.style.display = 'grid';
        overlay.classList.add('active'); // matches .features-modal-overlay-nfs.active
      }
      document.body.classList.add('modal-open');
      startSlider();
    },
    setStatus: function(text, type){
      if (statusEl){
        if (text != null) statusEl.textContent = text;
        statusEl.classList.remove('success','error','blocked','checking');
        if (type) statusEl.classList.add(type);
      }
    },
    close: function(){
      stopSlider();
      if (overlay){
        overlay.classList.remove('active');
        overlay.style.display = 'none';
      }
      document.body.classList.remove('modal-open');
    },
    closeAfter: function(ms){
      var self = this;
      setTimeout(function(){ self.close(); }, ms || 1200);
    }
  };
  window.NFS = NFS;

  // -------- Helpers --------
  function isInsideLoginForm(el){
    return formEl && (el === formEl || formEl.contains(el));
  }
  function openIfNotActive(text, type){
    if (!overlay) return NFS.open(text, type);
    var shown = overlay.classList.contains('active') || overlay.style.display === 'grid';
    if (!shown) NFS.open(text, type);
  }

  // Ensure login button submits form
  if (loginBtn && loginBtn.type !== 'submit') loginBtn.type = 'submit';

  // Open NFS when form is submitted (capture to run before other handlers)
  if (formEl){
    formEl.addEventListener('submit', function(){
      openIfNotActive('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦', 'checking');
    }, { capture: true });
  }

  // Open NFS on Enter from input or any control inside the form
  if (userInput){
    userInput.addEventListener('keydown', function(e){
      if (e.key === 'Enter' || e.keyCode === 13){
        openIfNotActive('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦', 'checking');
      }
    }, true);
  }
  document.addEventListener('keydown', function(e){
    if (e.key === 'Enter' || e.keyCode === 13){
      if (isInsideLoginForm(document.activeElement)){
        openIfNotActive('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦', 'checking');
      }
    }
  }, true);

  // -------- Reflect #msg changes from login.js --------
var patterns = {
  success: /ØªÙ…\s+ØªØ³Ø¬ÙŠÙ„\s+Ø§Ù„Ø¯Ø®ÙˆÙ„|Ù†Ø¬Ø§Ø­|ØªÙ…\s+Ø§Ù„Ø¯Ø®ÙˆÙ„|success/i,
  blocked: /Ù…Ø­Ø¸ÙˆØ±|blocked/i,
  error:   /ÙØ´Ù„|Ø®Ø·Ø£|ØºÙŠØ±\s+ØµØ­ÙŠØ­|Ø±ÙØ¶|error|invalid/i,
  checking:/Ø¬Ø§Ø±|Ø§Ù„ØªØ­Ù‚Ù‚|checking/i,
  unreachable: /(ÙŠØªØ¹Ø°Ø±|ØªØ¹Ø°Ø±)\s+Ø§Ù„Ø§ØªØµØ§Ù„\s+Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…|server\s*(is\s*)?unreachable|network\s*error|failed\s*to\s*fetch/i // â† Ø£Ø¶ÙÙ Ù‡Ø°Ø§
};


function handleMsgChange(text){
  var t = (text || '').trim();
  if (!t) return;

  if (patterns.success.test(t)) {
    NFS.setStatus('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'success');
    return;
  }
  if (patterns.blocked.test(t)) {
    NFS.setStatus('Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ±', 'blocked');
    NFS.closeAfter(500);
     hardReload(1500);
    return;
  }

  // ğŸ‘‡ Ø¶Ø¹ unreachable Ù‡Ù†Ø§ Ù‚Ø¨Ù„ error Ùˆ checking
  if (patterns.unreachable.test(t)) {
    NFS.setStatus('ÙŠØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… â€” Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©â€¦', 'error');
    NFS.closeAfter(600);
    hardReload(800);   // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ ÙƒØ³Ø± Ø§Ù„ÙƒØ§Ø´
    return;
  }

  if (patterns.error.test(t)) {
    NFS.setStatus('ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
    NFS.closeAfter(500);
    hardReload(1500);
    return;
  }
  if (patterns.checking.test(t)) {
    NFS.setStatus('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦', 'checking');
    return;
  }

  NFS.setStatus(t, 'checking');
}


  if (msgEl){
    // Primary observer
    var mo = new MutationObserver(function(){
      handleMsgChange(msgEl.textContent);
    });
    mo.observe(msgEl, { childList: true, subtree: true, characterData: true });

    // Initialize if msg already has content
    if ((msgEl.textContent || '').trim()) handleMsgChange(msgEl.textContent);

    // Safety: if first state becomes "checking", open modal automatically
    var firstCheckingShown = false;
    var mo2 = new MutationObserver(function(){
      var t = (msgEl.textContent || '').trim();
      if (!firstCheckingShown && patterns.checking.test(t)){
        firstCheckingShown = true;
        openIfNotActive('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚â€¦', 'checking');
      }
    });
    mo2.observe(msgEl, { childList: true, subtree: true, characterData: true });
  }

  // No manual close (no ESC / backdrop click listeners by design)
})();
</script>


</body>
</html>
